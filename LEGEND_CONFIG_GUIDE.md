# 🎨 圖例排序配置使用指南

## 📖 概述

現在您可以**自由調整所有圖表的圖例順序**，只需編輯一個配置文件！

所有圖表的圖例順序都在 `legendConfig.js` 中統一管理，讓您輕鬆自訂圖例的顯示順序，甚至隱藏不需要的圖例。

---

## 📁 配置文件位置

```
dashboard/src/config/legendConfig.js
```

---

## 🎯 主要功能

### ✅ 自訂圖例順序
- 調整圖例從左到右（或上到下）的顯示順序
- 例如：把折線圖圖例放在長條圖前面

### ✅ 隱藏圖例項目
- 移除不需要的圖例項目
- 例如：只顯示主要產品，隱藏「其它」類別

### ✅ 支援所有圖表
- **財務趨勢** - 9 個圖表（chart1-chart9）
- **產品客戶分析** - 6 個圖表
- **Book to Bill** - 趨勢圖

### ✅ 即時生效
- 修改後保存文件
- 瀏覽器會自動更新（熱模組替換）

---

## 🚀 快速開始

### 步驟 1：打開配置文件

```bash
# 使用您喜歡的編輯器
code dashboard/src/config/legendConfig.js
# 或
vim dashboard/src/config/legendConfig.js
```

### 步驟 2：找到要修改的圖表配置

例如，要修改「合併營收淨額與銷貨毛利率」（圖一）：

```javascript
// 圖一：合併營收淨額與銷貨毛利率
chart1: [
  'CS',
  'Si',
  '其它',
  '銷貨毛利率(%)'
],
```

### 步驟 3：調整圖例順序

**範例：把折線圖放在最前面**

```javascript
chart1: [
  '銷貨毛利率(%)',  // 折線圖移到最前面
  'CS',              // 長條圖跟在後面
  'Si',
  '其它'
],
```

### 步驟 4：保存並查看效果

- 保存文件（Ctrl+S 或 Cmd+S）
- 瀏覽器會自動重新載入
- 圖例順序已更新！

---

## 💡 使用範例

### 範例 1：調整順序 - 折線圖在前

**目標**：讓折線圖圖例顯示在長條圖前面

**修改前**：
```javascript
chart1: [
  'CS',
  'Si',
  '其它',
  '銷貨毛利率(%)'
]
```

**修改後**：
```javascript
chart1: [
  '銷貨毛利率(%)',  // ← 折線圖移到第一位
  'CS',
  'Si',
  '其它'
]
```

**結果**：圖例顯示為 `[銷貨毛利率(%) CS Si 其它]`

---

### 範例 2：隱藏圖例 - 不顯示「其它」

**目標**：只顯示 CS、Si 和毛利率，隱藏「其它」類別

**修改前**：
```javascript
chart1: [
  'CS',
  'Si',
  '其它',
  '銷貨毛利率(%)'
]
```

**修改後**：
```javascript
chart1: [
  'CS',
  'Si',
  '銷貨毛利率(%)'
  // 移除 '其它'，它將不會顯示在圖例中
]
```

**結果**：圖例只顯示 `[CS Si 銷貨毛利率(%)]`

---

### 範例 3：調整費用順序 - 依重要性排列

**目標**：將費用按重要性排列（銷售 > 研發 > 管理）

**修改前**：
```javascript
chart6: [
  '研發費用(M NTD)',
  '管理費用(M NTD)',
  '銷售費用(M NTD)',
  '營業費用率(%)'
]
```

**修改後**：
```javascript
chart6: [
  '營業費用率(%)',      // 折線圖在最前
  '銷售費用(M NTD)',    // 最重要的費用
  '研發費用(M NTD)',
  '管理費用(M NTD)'
]
```

**結果**：圖例順序調整為您指定的順序

---

### 範例 4：還原預設順序

**方法 1：設為 null**
```javascript
chart1: null  // 使用預設順序
```

**方法 2：參考文件底部的圖例名稱清單**
```javascript
// 複製預設配置
chart1: [
  'CS',
  'Si',
  '其它',
  '銷貨毛利率(%)'
]
```

---

## 📊 支援的圖表清單

### 💼 財務趨勢圖表

| 配置鍵 | 圖表名稱 | 圖例數量 |
|--------|----------|----------|
| `chart1` | 合併營收淨額與銷貨毛利率 | 4 項 |
| `chart2` | 銷貨退回與折讓 | 2 項 |
| `chart3` | 營業毛利與營業毛利率 | 2 項 |
| `chart4` | 存貨與跌價損失 | 2 項 |
| `chart5` | 閒置產能損失 | 1 項 |
| `chart6` | 營業費用與營業費用率 | 4 項 |
| `chart7` | 營業利益與營業利益率 | 2 項 |
| `chart8` | EBITDA與EBITDA率 | 2 項 |
| `chart9` | 稅後淨利與稅後淨利率 | 2 項 |

### 📊 產品客戶分析圖表

| 配置鍵 | 圖表名稱 | 說明 |
|--------|----------|------|
| `productSales` | 產品別銷售分析 | 產品名稱動態顯示 |
| `customerSales` | 客戶別銷售分析 | 客戶名稱動態顯示 |
| `productProfit` | 產品毛利貢獻分析 | 產品名稱動態顯示 |
| `customerABC` | 客戶分級分析 | 2 項固定圖例 |
| `productMix` | 產品組合分析 | 4 項固定圖例 |
| `productBCG` | BCG產品矩陣分析 | 產品名稱動態顯示 |

### 📈 Book to Bill 圖表

| 配置鍵 | 圖表名稱 | 圖例數量 |
|--------|----------|----------|
| `bookToBillHeatmap` | 熱力圖 | 無圖例 |
| `bookToBillTrend` | 實際出貨 + N月比值 | 4 項 |

---

## 🔍 如何找到圖例名稱

### 方法 1：查看配置文件底部的參考清單

打開 `legendConfig.js`，滾動到文件底部，有完整的圖例名稱清單：

```javascript
/**
 * 💼 財務趨勢圖表
 * ─────────────────────────────────────
 *
 * 【圖一：合併營收淨額與銷貨毛利率】
 * ├─ CS
 * ├─ Si
 * ├─ 其它
 * └─ 銷貨毛利率(%)
 *
 * ... (更多圖表)
 */
```

### 方法 2：在瀏覽器中查看

1. 打開 Dashboard（http://localhost:5175/）
2. 查看圖表底部的圖例
3. 複製圖例上的文字（包含標點符號）

### 方法 3：使用瀏覽器開發者工具

1. 按 F12 打開開發者工具
2. 在 Console 輸入：`console.log(legendConfig)`
3. 查看當前配置

---

## ⚠️ 注意事項

### 🔴 圖例名稱必須完全一致

**錯誤範例**：
```javascript
chart1: [
  'CS',
  'Si',
  '其他',           // ❌ 錯誤：應該是「其它」
  '銷貨毛利率(%)'
]
```

**正確範例**：
```javascript
chart1: [
  'CS',
  'Si',
  '其它',           // ✅ 正確
  '銷貨毛利率(%)'
]
```

### 🔴 標點符號也要一致

**錯誤範例**：
```javascript
chart2: [
  '銷貨退回與折讓(M NTD)',
  '佔合併營收總額比重 (%)'  // ❌ 錯誤：% 前多了空格
]
```

**正確範例**：
```javascript
chart2: [
  '銷貨退回與折讓(M NTD)',
  '佔合併營收總額比重(%)'   // ✅ 正確
]
```

### 🔴 陣列語法要正確

**錯誤範例**：
```javascript
chart1: [
  'CS',
  'Si',
  '其它'
  '銷貨毛利率(%)'  // ❌ 錯誤：缺少逗號
]
```

**正確範例**：
```javascript
chart1: [
  'CS',
  'Si',
  '其它',          // ✅ 正確：有逗號
  '銷貨毛利率(%)'
]
```

---

## 🛠️ 疑難排解

### 問題 1：修改後圖例沒有變化

**可能原因**：
1. 圖例名稱拼寫錯誤
2. 標點符號不一致
3. JavaScript 語法錯誤

**解決方法**：
1. 打開瀏覽器開發者工具（F12）
2. 查看 Console 是否有錯誤訊息
3. 對照配置文件底部的參考清單
4. 確保 JavaScript 陣列語法正確（逗號、括號等）

---

### 問題 2：圖例項目消失了

**可能原因**：
- 圖例名稱未包含在陣列中

**解決方法**：
```javascript
// 如果某個圖例消失了，確保它在陣列中
chart1: [
  'CS',
  'Si',
  '其它',           // ← 確保所有需要的項目都列出
  '銷貨毛利率(%)'
]
```

---

### 問題 3：整個圖表出錯

**可能原因**：
- JavaScript 語法錯誤（缺少逗號、括號不匹配等）

**解決方法**：
1. 檢查語法：確保每行後面有逗號（最後一行除外）
2. 檢查括號匹配：`[` 要有對應的 `]`
3. 還原為 `null` 測試：`chart1: null`
4. 如果還原後正常，說明是配置語法問題

---

### 問題 4：不知道圖例的正確名稱

**解決方法**：
1. 查看 `legendConfig.js` 文件底部的參考清單
2. 或者直接從瀏覽器圖表上複製圖例文字
3. 使用 Ctrl+F 在配置文件中搜尋圖表名稱

---

## 📋 完整配置範例

### 財務趨勢圖表完整配置

```javascript
export const legendConfig = {
  // 圖一：折線圖在前
  chart1: [
    '銷貨毛利率(%)',
    'CS',
    'Si',
    '其它'
  ],

  // 圖二：預設順序
  chart2: null,

  // 圖三：隱藏部分圖例
  chart3: [
    '營業毛利(M NTD)'
    // 不顯示毛利率
  ],

  // 圖四-圖九：使用預設配置
  chart4: null,
  chart5: null,
  chart6: null,
  chart7: null,
  chart8: null,
  chart9: null,
};
```

### 產品客戶分析配置

```javascript
export const legendConfig = {
  // ... 財務圖表配置 ...

  // 產品組合分析：調整順序
  productMix: [
    '平均毛利率(%)',      // 折線圖在前
    '高毛利產品營收',
    '中毛利產品營收',
    '低毛利產品營收'
  ],

  // 其他圖表使用預設
  productSales: null,
  customerSales: null,
  productProfit: null,
  customerABC: null,
  productBCG: null,
};
```

---

## 💻 進階技巧

### 技巧 1：批次調整所有圖表

如果想讓所有圖表的折線圖都放在最前面：

```javascript
export const legendConfig = {
  chart1: ['銷貨毛利率(%)', 'CS', 'Si', '其它'],
  chart2: ['佔合併營收總額比重(%)', '銷貨退回與折讓(M NTD)'],
  chart3: ['營業毛利率(%)', '營業毛利(M NTD)'],
  chart4: ['庫存損失率(%)', '存貨與跌價損失(M NTD)'],
  // ... 依此類推
};
```

### 技巧 2：使用變數避免重複

```javascript
// 定義常用的圖例名稱
const REVENUE = '營收(M NTD)';
const MARGIN = '毛利率(%)';
const RATE = '比重(%)';

export const legendConfig = {
  chart1: [
    'CS',
    'Si',
    '其它',
    '銷貨毛利率(%)'
  ],
  // ... 其他配置
};
```

### 技巧 3：添加註釋說明

```javascript
export const legendConfig = {
  // 圖一：將毛利率放在最前面，因為這是重點指標
  chart1: [
    '銷貨毛利率(%)',  // 最重要的指標
    'CS',             // 主要產品線
    'Si',             // 次要產品線
    '其它'            // 其他類別
  ],
};
```

---

## 🎨 最佳實踐

### ✅ 建議做法

1. **保持一致性** - 同類型的圖表使用相同的圖例順序
2. **重點在前** - 把最重要的指標放在最前面
3. **添加註釋** - 說明為什麼這樣排序
4. **測試驗證** - 修改後在瀏覽器中確認效果
5. **備份配置** - 修改前複製一份原始配置

### ❌ 避免做法

1. **不要隨意刪除** - 除非確定不需要該圖例
2. **不要混淆名稱** - 必須使用完全一致的圖例名稱
3. **不要忘記逗號** - JavaScript 陣列語法很重要
4. **不要過度複雜** - 保持配置簡單清晰

---

## 📞 需要協助？

### 檢查清單

遇到問題時，依序檢查：

- [ ] 圖例名稱是否完全一致（包含空格和標點符號）？
- [ ] JavaScript 語法是否正確（逗號、括號）？
- [ ] 瀏覽器 Console 是否有錯誤訊息？
- [ ] 是否保存了文件？
- [ ] 瀏覽器是否自動更新？

### 快速修復

如果遇到問題無法解決：

```javascript
// 臨時還原為預設配置
export const legendConfig = {
  chart1: null,
  chart2: null,
  chart3: null,
  chart4: null,
  chart5: null,
  chart6: null,
  chart7: null,
  chart8: null,
  chart9: null,

  productSales: null,
  customerSales: null,
  productProfit: null,
  customerABC: null,
  productMix: null,
  productBCG: null,

  bookToBillHeatmap: null,
  bookToBillTrend: null,
};
```

然後逐個圖表慢慢調整。

---

## 🎉 總結

### 現在您可以：

- ✅ **自由調整圖例順序** - 把重要的放在前面
- ✅ **隱藏不需要的圖例** - 讓圖表更簡潔
- ✅ **統一管理所有圖表** - 一個文件掌控全局
- ✅ **即時預覽效果** - 修改後立即看到變化

### 快速開始三步驟：

1. **打開** `dashboard/src/config/legendConfig.js`
2. **修改** 圖例順序陣列
3. **保存** 並在瀏覽器查看效果

---

## 📚 相關文檔

- `legendConfig.js` - 圖例配置文件（包含完整參考清單）
- `TEXT_CONFIG_GUIDE.md` - 文字配置使用指南
- `CODE_CLEANUP_SUMMARY.md` - 代碼清理總結
- `DEPLOYMENT_GUIDE.md` - 部署指南

---

**最後更新**: 2025-10-28
**維護人員**: Claude Code Assistant

**祝您使用愉快！** 🎨✨
